{% extends 'template.html' %}

{% block title %}Dashboard de {{ usuario.nome }}{% endblock %}

{% block content %}
<div class="container d-flex column" style="margin-bottom: 100px;">
    <div class="subtitulo" style="margin-bottom: 50px;">
        Olá, <span style="font-weight: 700;">{{ usuario.nome }}</span>!
    </div>

    <div class="reminders outline border-radius d-flex add-gap">

        <!-- Meus Pets -->
        <div class="reminder outline">
            <div><span class="destaque">Meus pets </span></div>
            <a href="/cadastrar_pet">+ Adicionar pet</a>
            {% if pets %}
            <div class="pets">
                {% for pet in pets %}
                <div class="pet border-radius">
                    <div class="d-flex between">
                        <a href="/editar_pet/{{pet.id}}">Editar info</a>
                        <a href="/remover_pet/{{pet.id}}">Remover</a>
                    </div>
                    <p class="destaque" style="color: var(--cor-preto);">{{pet.nome}}</p>
                    <p>{{pet.raca}}, {{pet.idade}} anos, {{pet.peso}} kg</p>

                    <!-- Dose de medicamento -->
                    <p class="destaque" style="color: var(--cor-preto);">Quantidade de medicamento</p>
                    <div class="d-flex add-gap">
                        {% if pet.medicamento %}
                        <p>{{pet.medicamento}} mg</p>
                        {% endif %}
                        <a href="/calcular_dose/{{pet.id}}">Fazer cálculo</a>
                    </div>

                    <!-- Dose de soro -->
                    <p class="destaque" style="color: var(--cor-preto);">Dose de soro</p>
                    <div class="d-flex add-gap">
                        {% if pet.soro %}
                        <p>{{pet.soro}} mL</p>
                        {% endif %}
                        <a href="/calcular_soro/{{pet.id}}">Fazer cálculo</a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div>Não há nenhum pet registrado</div>
            {% endif %}
        </div>

        <!-- Consultas -->
        <div class="reminder outline">
            <div class="destaque">Consultas</div>
            <a href="/agendar">+ Marcar consulta</a>
            {% if consultas %}
            <div class="pets">
                {% for consulta in consultas %}
                <div class="pet border-radius">
                    <div class="d-flex between">
                        <a href="/desmarcar/{{consulta.id}}">Desmarcar</a>
                        <a href="/editar_consulta/{{consulta.id}}">Editar</a>
                    </div>
                    {% set pet_info = pets | selectattr('id','equalto',consulta.pet_agendar) | first %}
                    <p class="destaque" style="color: var(--cor-preto);">
                        {{consulta.tipo}} — Pet: {{ pet_info.nome if pet_info else "Desconhecido" }}
                    </p>
                    <p>{{consulta.datahora}}</p>
                    <p>{{consulta.desc}}</p>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div>Não há nenhuma consulta marcada</div>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}
